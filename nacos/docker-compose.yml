version: "3.8"
services:
  mysql:
    image: mysql:5.7
    container_name: nacos-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: nacos_config
    volumes:
      - ./mysql-data:/var/lib/mysql
      # init.dæ–‡ä»¶å¤¹é‡Œé¢å¿…é¡»æ”¾ç€ mysql-schema.sql æ–‡ä»¶
      - ./init.d:/docker-entrypoint-initdb.d 
    ports:
      - "3307:3306" # å¤–éƒ¨å·¥å…·(Navicat)è¿æ¥ç”¨ 3307
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    restart: always

  # 2. Nacos æœåŠ¡
  nacos:
    image: nacos/nacos-server:latest
    container_name: nacos-standalone-mysql
    depends_on:
      - mysql  # ğŸ‘ˆ å…³é”®ï¼šè®© Nacos ç­‰ MySQL å¯åŠ¨
    environment:
      - MODE=standalone
      - NACOS_AUTH_ENABLE=true
      - NACOS_AUTH_TOKEN=U2VjcmV0S2V5MDEyMzQ1Njc4OTAxMjM0NTY3ODkwMTIzNDU2Nzg5
      - NACOS_AUTH_IDENTITY_KEY=nacos
      - NACOS_AUTH_IDENTITY_VALUE=nacos
      - SPRING_DATASOURCE_PLATFORM=mysql
      - MYSQL_SERVICE_HOST=mysql
      - MYSQL_SERVICE_PORT=3306
      - MYSQL_SERVICE_DB_NAME=nacos_config
      - MYSQL_SERVICE_USER=root
      - MYSQL_SERVICE_PASSWORD=root
    ports:
      - "8848:8848"
      - "10010:8080" # Nacos 3.x æ§åˆ¶å°ç«¯å£
      - "9848:9848"
    restart: always
