<!-- 模态框：创建/编辑提示词模板 -->
<div class="modal fade" id="promptTemplateModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="promptTemplateModalLabel">添加提示词模板</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="promptTemplateForm">
                    <input type="hidden" id="templateRowId" name="id">
                    
                    <div class="mb-3">
                        <label for="templateName" class="form-label">模板名称 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="templateName" name="template_name" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="functionCategory" class="form-label">功能分类</label>
                        <input type="text" class="form-control" id="functionCategory" name="function_category">
                        <div class="form-text">可选：便于检索的任意文本，如所属功能分类等</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="owner" class="form-label">负责人</label>
                                <input type="text" class="form-control" id="owner" name="owner">
                                <div class="form-text">可选：模板负责人</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="qcNumber" class="form-label">QC号</label>
                                <input type="text" class="form-control" id="qcNumber" name="qc_number">
                                <div class="form-text">可选：QC编号</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="promptSource" class="form-label">提示词来源</label>
                                <input type="text" class="form-control" id="promptSource" name="prompt_source">
                                <div class="form-text">可选：提示词来源</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="form-label mb-0">系统提示词</label>
                            <select class="form-select form-select-sm w-auto" id="systemPromptMode" name="systemPromptMode" style="min-width: 150px;">
                                <option value="default" selected>系统默认</option>
                                <option value="none">空</option>
                                <option value="custom">自定义</option>
                            </select>
                        </div>
                        <textarea class="form-control prompt-textarea" id="systemPrompt" name="system_prompt" rows="8" placeholder="使用系统默认配置" disabled></textarea>
                        <div class="form-text">可选：系统级别的提示词模板。支持变量格式：&lt;$变量名&gt;</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="userPrompt" class="form-label">用户提示词</label>
                        <textarea class="form-control prompt-textarea" id="userPrompt" name="user_prompt" rows="8" placeholder="输入用户提示词..."></textarea>
                        <div class="form-text">可选：用户级别的提示词模板。支持变量格式：&lt;$变量名&gt;</div>
                    </div>

                    <!-- 模型入参配置 -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-cogs"></i> 模型入参配置</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <label class="form-label mb-0">最大Token数</label>
                                            <select class="form-select form-select-sm w-auto" id="maxTokensMode" name="maxTokensMode" style="min-width: 120px;">
                                                <option value="default" selected>系统默认</option>
                                                <option value="none">空</option>
                                                <option value="custom">自定义</option>
                                            </select>
                                        </div>
                                        <input type="number" class="form-control" id="maxTokens" name="max_tokens" min="1" disabled>
                                        <div class="form-text">生成的最大token数量</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <label class="form-label mb-0">温度参数</label>
                                            <select class="form-select form-select-sm w-auto" id="temperatureMode" name="temperatureMode" style="min-width: 120px;">
                                                <option value="default" selected>系统默认</option>
                                                <option value="none">空</option>
                                                <option value="custom">自定义</option>
                                            </select>
                                        </div>
                                        <input type="number" class="form-control" id="temperature" name="temperature" min="0" max="2" step="0.01"  disabled>
                                        <div class="form-text">控制输出随机性，范围0-2</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <label class="form-label mb-0">Top-P参数</label>
                                            <select class="form-select form-select-sm w-auto" id="topPMode" name="topPMode" style="min-width: 120px;">
                                                <option value="default" selected>系统默认</option>
                                                <option value="none">空</option>
                                                <option value="custom">自定义</option>
                                            </select>
                                        </div>
                                        <input type="number" class="form-control" id="topP" name="top_p" min="0" max="1" step="0.01"  disabled>
                                        <div class="form-text">核采样概率阈值，范围0-1</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <label class="form-label mb-0">Top-K参数</label>
                                            <select class="form-select form-select-sm w-auto" id="topKMode" name="topKMode" style="min-width: 120px;">
                                                <option value="default" selected>系统默认</option>
                                                <option value="none">空</option>
                                                <option value="custom">自定义</option>
                                            </select>
                                        </div>
                                        <input type="number" class="form-control" id="topK" name="top_k" min="0"  disabled>
                                        <div class="form-text">保留概率最高的K个token</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 评估配置 -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-chart-line"></i> 评估策略</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="form-text mb-2">可选：选择一个或多个评估策略用于评估模板生成的内容</div>
                                <div id="evaluationStrategiesContainer">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="exact_match" id="strategy_exact_match">
                                        <label class="form-check-label" for="strategy_exact_match">
                                            <strong>精确匹配</strong> <span class="text-muted small">- 与参考答案完全一致 </span>
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="json_key_match" id="strategy_json_key_match">
                                        <label class="form-check-label" for="strategy_json_key_match">
                                            <strong>JSON 键匹配</strong> <span class="text-muted small">- 校验输出能否解析为 JSON 且键集合与参考一致</span>
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="answer_accuracy" id="strategy_answer_accuracy">
                                        <label class="form-check-label" for="strategy_answer_accuracy">
                                            <strong>答案准确率</strong> <span class="text-muted small">- LLM 评估生成答案与参考答案的语义一致性程度</span>
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="factual_correctness" id="strategy_factual_correctness">
                                        <label class="form-check-label" for="strategy_factual_correctness">
                                            <strong>事实正确性</strong> <span class="text-muted small">- 检查 LLM 生成的答案与标准答案相比,事实是否正确</span>
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="semantic_similarity" id="strategy_semantic_similarity">
                                        <label class="form-check-label" for="strategy_semantic_similarity">
                                            <strong>语义相似性</strong> <span class="text-muted small">- 使用BERT系列模型计算生成内容与参考答案的语义相似度</span>
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="bleu" id="strategy_bleu">
                                        <label class="form-check-label" for="strategy_bleu">
                                            <strong>BLEU</strong> <span class="text-muted small">- 基于n-gram匹配评估生成文本质量，常用于机器翻译</span>
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="rouge" id="strategy_rouge">
                                        <label class="form-check-label" for="strategy_rouge">
                                            <strong>ROUGE</strong> <span class="text-muted small">- 基于召回率的n-gram重叠度量，常用于文本摘要评估</span>
                                        </label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="checkbox" value="chrf" id="strategy_chrf">
                                        <label class="form-check-label" for="strategy_chrf">
                                            <strong>CHRF</strong> <span class="text-muted small">- 基于字符级F-score的评估指标，对形态丰富的语言更友好</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="remarks" class="form-label">备注</label>
                        <textarea class="form-control" id="remarks" name="remarks" rows="3" placeholder="输入备注信息..."></textarea>
                        <div class="form-text">可选：关于该模板的额外说明或使用建议</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="savePromptTemplate">保存</button>
            </div>
        </div>
    </div>
</div>
